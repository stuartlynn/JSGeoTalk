<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Mapping all the things - Girl Develop it Chicago </title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<style>
		  .tiles{
				height: 900px
			}
			.tiles div{
				display: inline-block;
				width: 400px;
				padding: 0px;
				margin:0px;
			}

			.tiles div p {
				font-size: 10px;

				padding: 0px;
				margin:0px;
			}

			.reveal .slides {
  			height: 100%;
				width : 90%;
  			top: 0;
  			margin-top: 0;
			}

			.reveal .slides>section {
  			min-height: 90%;
			}

			.reveal .slides>section img {
  			border:none;
			}

			.reveal .slides>section h2 {
				font-size: 1.5em;
			}

			.reveal .slides>section>section {
  			min-height: 100%;
			}

		</style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Torque: beyond points</h1>
					<h3>JSGeo</h3>
					<p>
						<small>Stuart Lynn / <a href="http://twitter.com/stuart_lybb">@stuart_lynn</a></small>
					</p>
				</section>



				<section>
					<h2>Stuart Lynn</h2>
					<h3>Map Scientist</h3>
					<img src='https://avatars1.githubusercontent.com/u/1799254?v=3&s=200'/>
				</section>

				<section>
					<h1>World is</h1>
					<h2>Space</h2>
					<h2>+</h2>
					<h2>Time</h2>
				</section>

				<section>
					<iframe width="100%" height="520" frameborder="0" src="https://team.cartodb.com/u/stuartlynn/viz/90fcd41a-15d7-11e5-b63d-0e6e1df11cbf/embed_map" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>
				<section>
					<iframe width="100%" height="520" frameborder="0" src="https://team.cartodb.com/u/stuartlynn/viz/40accd80-5db7-11e5-89a8-0e43f3deba5a/embed_map" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>

				<section>
					<iframe width="100%" height="520" frameborder="0" src="https://inbo.cartodb.com/u/lifewatch/viz/88c30be4-1063-11e5-a9ae-0e853d047bba/embed_map" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>


				<section>
					<iframe width="100%" height="520" frameborder="0" src="https://team.cartodb.com/u/stuartlynn/viz/10e31f54-6d67-11e5-97c3-0ea31932ec1d/embed_map" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>

				<section>
					<h2>Maps online are a data compresion problem</h2>
					<h3>Chris Whong's Taxi Data: 11Gb of taxi pick up and drop off's</h3>
				</section>

				<section>
					<h2>11 Million taxi drop offs and pick ups</h2>
					<video autoplay=true src='https://s3-us-west-2.amazonaws.com/cartodb-talk-data/TaxiSmall.mp4' controls></video>
				</section>

				<section>
					<iframe width="100%" height="520" frameborder="0" src="https://cartodb.com/torque/" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>

				<section>
					<img src="https://cartodb-libs.global.ssl.fastly.net/cartodb.com/files/img/layout/torque/graphic.4fab1875.png" alt="Torque" width="418" height="482">
				</section>

				<section>
					<h2>URL Schema</h2>
					<pre><code>
http://host.com/{z}/{x}/{y}.torque.[json|bin]
					</code></pre>
				</section>

				<section>
					<h2>Tile Format</h2>
					<pre><code>
[
	{
		x: 25,
		y: 77,
		values: [ 1, 10 ],
		steps: [214, 215]
	},
	...
]
					</code></pre>
				</section>


				<section>
					<h2>Metadata</h2>
					<pre><code>
{
	start: 0,
	end: 100,
	resolution: 2
	# scale: 1/resolution,
	data_steps: 365,
	column_type: "number"
	"minzoom": 0,
	"maxzoom": 11,
	"tiles": [
		'http://a.host.com/{z}/{x}/{y}.torque.json',
		'http://b.host.com/{z}/{x}/{y}.torque.json',
		'http://c.host.com/{z}/{x}/{y}.torque.json',
		'http://d.host.com/{z}/{x}/{y}.torque.json'
	],
	"bounds": [ -180, -85.05112877980659, 180, 85.0511287798066 ]
}
					</code></pre>
				</section>

				<section>
					<a href="https://github.com/CartoDB/tilecubes/blob/master/2.0/spec.md">Full Torque Spec</a><br/>
					<a href="https://github.com/CartoDB/torque">Torque.js</a>
				</section>


				<section>
					<pre><code>
var map = new L.Map('map', {
	zoomControl: true,
	center: [40, 0],
	zoom: 3
});

L.tileLayer('http://{s}.api.cartocdn.com/base-dark/{z}/{x}/{y}.png', {
	attribution: 'CartoDB'
}).addTo(map);

// initialize a torque layer that uses the CartoDB account details and SQL API to pull in data
var torqueLayer = new L.TorqueLayer({
	user: 'viz2',
	table: 'ow',
	cartocss: CARTOCSS
});

torqueLayer.addTo(map);
torqueLayer.play();
					</code></pre>
				</section>


				<section>
					<pre><code>
Map {
    -torque-time-attribute: "date";
    -torque-aggregation-function: "count(cartodb_id)";
    -torque-frame-count: 760;
    -torque-animation-duration: 15;
    -torque-resolution: 2;
}
#layer {
    marker-width: 3;
    marker-fill-opacity: 0.8;
    marker-fill: #FEE391;
    comp-op: "lighten";
    [value > 2] { marker-fill: #FEC44F; }
    [value > 3] { marker-fill: #FE9929; }
    [value > 4] { marker-fill: #EC7014; }
    [value > 5] { marker-fill: #CC4C02; }
    [value > 6] { marker-fill: #993404; }
    [value > 7] { marker-fill: #662506; }
    [frame-offset = 1] { marker-width: 10; marker-fill-opacity: 0.05;}
    [frame-offset = 2] { marker-width: 15; marker-fill-opacity: 0.02;}
}

					</code></pre>
				</section>

				<section>
					<h2>Three limiting problems</h2>
					<ul>
						<li>No ability to style according to value appart from selectors</li>
						<li>Only one variable to style on</li>
						<li>Only one tied to CartoDB as a data source.</li>
					</ul>
				</section>


				<section>
					<a href='https://github.com/CartoDB/torque/tree/stuart_experimental/examples'>https://github.com/CartoDB/torque/tree/stuart_experimental/examples</a>
				</section>

				<section>
					<pre><code>
[value > 2] { marker-fill: #FEC44F; }
[value > 3] { marker-fill: #FE9929; }
[value > 4] { marker-fill: #EC7014; }
[value > 5] { marker-fill: #CC4C02; }
[value > 6] { marker-fill: #993404; }
[value > 7] { marker-fill: #662506; }
					</code></pre>
					<h2>Ugly, verbose and not very easy to write</h2>
				</section>

				<section>
					<h2>Really want functons that scale properties with data</h2>
					<pre><code>
marker-width: "scale_lin(value0,0.0,10,0,5)";
marker-fill-opacity: "scale_sqrt(frame-offset,0,9,1,0)";
marker-type: ellipse;
marker-fill: "scale_lin(value1,0.1,5,blue,red)";
					</code></pre>
				</section>


				<section>
					<pre><code>
-torque-aggregation-function: "count(cartodb_id)";
					</code></pre>
					<h3>Only have 1 dimension to style with :-(</h3>
				</section>

				<section>
					<pre><code>
-torque-aggregation-function: "avg(abs(depth));avg(mag)";
					</code></pre>
				</section>


				<section>
					<iframe width="100%" height="520" frameborder="0" src="http://bl.ocks.org/stuartlynn/raw/62270a1cc029e4f58cc5/" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>



				<section>
					<h2>Renderers</h2>
					<p>Actually stored in <a href='https://github.com/CartoDB/torque/blob/point_labels/lib/torque/renderer/cartocss_render.js'>cartocss_render.js</a></p>
				</section>

				<section>
					<h2>Text renderer</h2>
					<pre><code>
text-name: "{{value}}c";
					</code></pre>
				</section>

				<section>
					<pre><code>

function renderText(ctx,st){
	var width = st['marker-width']

	var text = st['text-name']
	var font = st['text-face-name'] ? st['text-face-name'] : 'Droid Sans Regular'
	var textSize = st['text-size'] ? st['text-size'] : '10px'
	var color    = st['text-fill'] ? st['text-fill'] : 'white'

	// ctx.font = textSize+"px "+font
	ctx.fillStyle = color
	ctx.font= textSize + " " + font
	ctx.fillText(text, -width/2.0, width/2.0 )
}

					</code></pre>
				</section>



				<section>
					<h2>Text renderer</h2>
					<iframe width="100%" height="520" frameborder="0" src="http://bl.ocks.org/stuartlynn/raw/dcb7ecc4c6e402b91395/" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>

				<section>
					<iframe width="100%" height="520" frameborder="0" src="http://bl.ocks.org/stuartlynn/raw/173e5021f5b3ef0b6073/" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>


				<section>
					<h2>Vector Renderer</h2>
					<iframe width="100%" height="520" frameborder="0" src="http://bl.ocks.org/stuartlynn/raw/2737d488cbbd2574875c/" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
				</section>

				<section>
					<pre><code>
function renderVector(ctx, st){
    var angle = st['marker-angle']
    var color = st['marker-stroke']
    var mag   = st['marker-mag']
    var max_mag   = st['marker-max-mag'] ?  st['marker-max-mag'] : 10
    var max_line_length = st['marker-width']

    var scaled_mag = (mag/max_mag)*max_line_length

    ctx.lineWidth = 1

    // ctx.strokeStyle='green'
    // ctx.strokeRect(-max_line_length,-max_line_length,max_line_length*2,max_line_length*2)
    ctx.translate(max_line_length/2.0, -max_line_length/2.0)
    ctx.rotate(angle)
    ctx.strokeStyle = color
    ctx.moveTo(0,-max_line_length*2)
    ctx.lineTo(0,max_line_length*2)
    ctx.stroke();

  }
					</code></pre>
				</section>

				<section>
					<img src='https://files.slack.com/files-pri/T024FUQQ8-F08ECPR46/voronoi_torque.gif'></img>
				</section>


			<section>
				<h2>Providers</h2>
				<p>Allow you to map a data source to CartoDB</p>
			</section>

			<section>
				<h2>Redshift example</h2>
				<video autoplay=true src='https://s3-us-west-2.amazonaws.com/cartodb-talk-data/TaxiSmall.mp4' controls></video>
			</section>

			<section>
				<h2>See Chris Whong for info about a spark provider</h2>
			</section>

			<section>
				<h1>Go hack on Torque.</h1>
			</section>

			<section>
				<h2><a href='https://github.com/CartoDB/d3.cartodb'>d3.cartodb</a></h2>
			</section>

			<section>
				<pre><code>
var map = new L.Map("map", { center: [0, 0], zoom: 3 })
var layer = new d3.cartodb.Layer({
	user: 'rambo',
	sql_api_template: 'http://rambo.cartodb.com/'
});
layer.addTo(map);
layer.setSQL('select * form table');
layer.setCartoCSS('#test { marker-fill: red; }');
				</code></pre>
			</section>

			<section>
				<pre><code>
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        dates: [1,2,3...],
        values:[{pop: 10, crashes:2}, {pop:8, crashes:0}, {pop:8, crashes:1}...]
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": ...
      }

    }
    }
  ]
}
				</code></pre>
			</section>

				<!-- Example of nested vertical slides -->

			<section>
				<pre><code>
polygon-fill: lin_scale([0,100], ["red","blue"]);
				</code></pre>

				<pre><code>
    this.renderer.addFunction('lin_scale', function (args, done) {
      var domain    = args[0].value[0].value
      var range     = args[1].value[0].value
      done(function(v) {
      return {
        is: 'custom',
        toString: function() {
          return "(function() { if(!data.dates__uint16){return 'transparent';} var index; var prevDates = data.dates__uint16.map(function(d){return data['global']['step'] >= d }); var index = prevDates.indexOf(false) - 1; var val= data.vals__uint8[index]; var col =  d3.scale.linear().domain(["+domain+"]).range(["+range+"])(val); return col;  })();";
        }
      }
    });
  });

				</code></pre>
			</section>



			<section>
				<iframe width="100%" height="520" frameborder="0" src="http://torquie.cartodb.io/torque.html?title=Gun%20Shop%20vs%20Gun%20Control&table=gu_sheet1&user=andrew&join_col_input=state&type=most_searched&time=date&geom_type=hexstates&col_1=%23e47060&col_2=%236091bd&steps=auto&duration=20" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
			</section>

			<section>
				<a href="http://torquie-ny-buildings.cartodb.io/torque.html" >nyc buildings</a>
			</section>
			</div>
		</div>


		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
